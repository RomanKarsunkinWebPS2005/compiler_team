# Семантика языка программирования **Minion#**

---

## Области видимости

- Minion# использует **лексические (статические) области видимости**.
- Область видимости определяется **блочной структурой**: каждый блок `oca! ... stopa` создаёт новую вложенную область.
- **Глобальная область видимости** включает только те объявления, которые находятся **непосредственно на верхнем уровне программы** (после `bello!` и до любого блока `oca!`):
  - константы (`trusela`),
  - функции (`boss`),
  - переменные (`poop`), объявленные вне блоков.
- **Функции имеют доступ к именам из глобальной области**, но **не захватывают локальные переменные из внешних блоков**.
- **Замыканий нет**: если функции требуется значение извне, оно должно быть передано **явно как параметр**.
- **Локальные переменные** (объявленные внутри блока `oca! ... stopa`) **недоступны** вне этого блока, включая вложенные и вызываемые функции.

---

## Уникальность имён

- Имена **уникальны в пределах одной области видимости**.
- **Переменные и функции используют общее пространство имён**.
- **Переобъявление** (повторное объявление с тем же именем в одной области) — **ошибка компиляции**.
- **Скрытие (shadowing) запрещено**: нельзя объявить локальную переменную с тем же именем, что и в внешней области.
- **Имена встроенных функций** (`muak`, `miniboss`, `bigboss`) — **зарезервированы** и не могут использоваться как имена переменных или функций.
- **Имена встроенных типов** (`Papaya`, `Banana`, `Gelato`, `Baka`) — **зарезервированы** и не могут использоваться как идентификаторы.

---

## Параметры функций

- Параметры передаются **по значению**.
- Параметры ведут себя как **локальные переменные**:
  - им можно присваивать новые значения внутри функции,
  - их нельзя переобъявлять.
- **Несоответствие числа параметров** (формальных и фактических) — **ошибка компиляции**.
- **Фактические аргументы вычисляются строго слева направо**.
- Функция с типом возврата, отличным от `Baka`, **обязана содержать `tank yu` с выражением**.
- Функция типа `Baka` **может не содержать `tank yu`** — возврат происходит неявно в конце.

---

## Рекурсия

- **Рекурсия поддерживается**: функция может вызывать саму себя.
- **Взаимная рекурсия поддерживается**: функции A и B могут вызывать друг друга.
- Глубина рекурсии ограничена стеком выполнения (ошибки переполнения стека обрабатываются на уровне среды выполнения).

---

Конечно! Ниже — **исправленный и согласованный блок «Ветвления»** для файла `docs/specification/semantics.md`, учитывающий:

- поддержку логических операторов **над `Gelato` и `Banana`**,
- строгое требование **типа `Gelato` в условии `bi-do`**,
- отсутствие `switch`.

---

## Ветвления

### Тип условия
- Выражение в конструкции `bi-do` **обязательно должно иметь тип `Gelato`**.
- Использование выражений типов `Banana`, `Papaya` или `Baka` в условии — **ошибка компиляции**.

### Значения истины и лжи
- **Истина**: только значение `da` (типа `Gelato`)
- **Ложь**: только значение `no` (типа `Gelato`)
- Неявное преобразование чисел (`0` → `no`, `≠0` → `da`) **не поддерживается** в условиях.

> Примечание: логические операторы (`tropa`, `bo-ca`, `makoroni`) могут работать с числами (`Banana`), возвращая `0`/`1`, но **результат такого выражения нельзя использовать напрямую в `bi-do`**, так как он имеет тип `Banana`, а не `Gelato`.

### Выполнение веток
- Если условие вычисляется как **`da`** → выполняется **блок сразу после `bi-do`** (`oca! ... stopa`).
- Если условие вычисляется как **`no`**:
  - и присутствует ветка `uh-oh` → выполняется **блок после `uh-oh`**,
  - и ветка `uh-oh` отсутствует → управление передаётся следующей инструкции.

### Конструкция switch
- Конструкция аналога `switch..case` **не поддерживается**.
- Множественное ветвление реализуется через последовательные или вложенные конструкции `bi-do` / `uh-oh`.

---

## Циклы

### Цикл `kemari` (`while`)
- Выполняется, пока условие — `da`.
- Условие должно быть типа `Gelato`.
- Проверка условия — **перед каждой итерацией**.

### Цикл `again` (`for i = start to end`)
- Работает по схеме:
  1. Инициализация счётчика `i` значением `start` (должно быть `Banana`).
  2. Пока `i <= end` — выполняется тело.
  3. После каждой итерации `i` увеличивается на `1`.
- Переменная `i` **должна быть объявлена как `Banana` до цикла**.
- Изменение `i` внутри тела **разрешено**.

> **Примечание**: язык **не поддерживает** инструкции `break` и `continue`.  
> Выход из цикла возможен **только через изменение условия**.

---

## Прочие правила

### Присваивание
- В левой части `lumai` **должна быть переменная**, объявленная ранее.
- Нельзя присвоить значение **константе** (`trusela`) — ошибка компиляции.
- Нельзя присвоить значение **необъявленной переменной**.
- Нельзя присвоить значение **переменной, объявленной в другой области видимости с тем же именем** (скрытие запрещено).

### Инициализация
- Доступ к **неинициализированной переменной** — **ошибка выполнения**.

### Константы
- `trusela` — константа времени компиляции.
- Инициализируется **только литералом или встроенной константой** (`belloPi`, `belloE`).
- Попытка изменения — **ошибка компиляции**.

### Встроенные функции
- `muak`, `miniboss`, `bigboss` — работают только с числовыми типами (`Papaya`, `Banana`).
- Передача `Gelato` или `Baka` — **ошибка компиляции**.

---